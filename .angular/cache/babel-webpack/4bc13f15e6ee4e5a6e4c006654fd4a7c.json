{"ast":null,"code":"import { __values } from \"tslib\";\nimport { Subscription } from '../Subscription';\nimport { operate } from '../util/lift';\nimport { OperatorSubscriber } from './OperatorSubscriber';\nimport { arrRemove } from '../util/arrRemove';\nimport { asyncScheduler } from '../scheduler/async';\nimport { popScheduler } from '../util/args';\nexport function bufferTime(bufferTimeSpan) {\n  var _a, _b;\n\n  var otherArgs = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    otherArgs[_i - 1] = arguments[_i];\n  }\n\n  var scheduler = (_a = popScheduler(otherArgs)) !== null && _a !== void 0 ? _a : asyncScheduler;\n  var bufferCreationInterval = (_b = otherArgs[0]) !== null && _b !== void 0 ? _b : null;\n  var maxBufferSize = otherArgs[1] || Infinity;\n  return operate(function (source, subscriber) {\n    var bufferRecords = [];\n    var restartOnEmit = false;\n\n    var emit = function (record) {\n      var buffer = record.buffer,\n          subs = record.subs;\n      subs.unsubscribe();\n      arrRemove(bufferRecords, record);\n      subscriber.next(buffer);\n      restartOnEmit && startBuffer();\n    };\n\n    var startBuffer = function () {\n      if (bufferRecords) {\n        var subs = new Subscription();\n        subscriber.add(subs);\n        var buffer = [];\n        var record_1 = {\n          buffer: buffer,\n          subs: subs\n        };\n        bufferRecords.push(record_1);\n        subs.add(scheduler.schedule(function () {\n          return emit(record_1);\n        }, bufferTimeSpan));\n      }\n    };\n\n    bufferCreationInterval !== null && bufferCreationInterval >= 0 ? subscriber.add(scheduler.schedule(function () {\n      startBuffer();\n      !this.closed && subscriber.add(this.schedule(null, bufferCreationInterval));\n    }, bufferCreationInterval)) : restartOnEmit = true;\n    startBuffer();\n    var bufferTimeSubscriber = new OperatorSubscriber(subscriber, function (value) {\n      var e_1, _a;\n\n      var recordsCopy = bufferRecords.slice();\n\n      try {\n        for (var recordsCopy_1 = __values(recordsCopy), recordsCopy_1_1 = recordsCopy_1.next(); !recordsCopy_1_1.done; recordsCopy_1_1 = recordsCopy_1.next()) {\n          var record = recordsCopy_1_1.value;\n          var buffer = record.buffer;\n          buffer.push(value);\n          maxBufferSize <= buffer.length && emit(record);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (recordsCopy_1_1 && !recordsCopy_1_1.done && (_a = recordsCopy_1.return)) _a.call(recordsCopy_1);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    }, function () {\n      while (bufferRecords === null || bufferRecords === void 0 ? void 0 : bufferRecords.length) {\n        subscriber.next(bufferRecords.shift().buffer);\n      }\n\n      bufferTimeSubscriber === null || bufferTimeSubscriber === void 0 ? void 0 : bufferTimeSubscriber.unsubscribe();\n      subscriber.complete();\n      subscriber.unsubscribe();\n    }, undefined, function () {\n      return bufferRecords = null;\n    });\n    source.subscribe(bufferTimeSubscriber);\n  });\n}","map":{"version":3,"sources":["/Users/netanelbasal/www/effects/node_modules/rxjs/dist/esm5/internal/operators/bufferTime.js"],"names":["__values","Subscription","operate","OperatorSubscriber","arrRemove","asyncScheduler","popScheduler","bufferTime","bufferTimeSpan","_a","_b","otherArgs","_i","arguments","length","scheduler","bufferCreationInterval","maxBufferSize","Infinity","source","subscriber","bufferRecords","restartOnEmit","emit","record","buffer","subs","unsubscribe","next","startBuffer","add","record_1","push","schedule","closed","bufferTimeSubscriber","value","e_1","recordsCopy","slice","recordsCopy_1","recordsCopy_1_1","done","e_1_1","error","return","call","shift","complete","undefined","subscribe"],"mappings":"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","sourcesContent":["import { __values } from \"tslib\";\nimport { Subscription } from '../Subscription';\nimport { operate } from '../util/lift';\nimport { OperatorSubscriber } from './OperatorSubscriber';\nimport { arrRemove } from '../util/arrRemove';\nimport { asyncScheduler } from '../scheduler/async';\nimport { popScheduler } from '../util/args';\nexport function bufferTime(bufferTimeSpan) {\n    var _a, _b;\n    var otherArgs = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        otherArgs[_i - 1] = arguments[_i];\n    }\n    var scheduler = (_a = popScheduler(otherArgs)) !== null && _a !== void 0 ? _a : asyncScheduler;\n    var bufferCreationInterval = (_b = otherArgs[0]) !== null && _b !== void 0 ? _b : null;\n    var maxBufferSize = otherArgs[1] || Infinity;\n    return operate(function (source, subscriber) {\n        var bufferRecords = [];\n        var restartOnEmit = false;\n        var emit = function (record) {\n            var buffer = record.buffer, subs = record.subs;\n            subs.unsubscribe();\n            arrRemove(bufferRecords, record);\n            subscriber.next(buffer);\n            restartOnEmit && startBuffer();\n        };\n        var startBuffer = function () {\n            if (bufferRecords) {\n                var subs = new Subscription();\n                subscriber.add(subs);\n                var buffer = [];\n                var record_1 = {\n                    buffer: buffer,\n                    subs: subs,\n                };\n                bufferRecords.push(record_1);\n                subs.add(scheduler.schedule(function () { return emit(record_1); }, bufferTimeSpan));\n            }\n        };\n        bufferCreationInterval !== null && bufferCreationInterval >= 0\n            ?\n                subscriber.add(scheduler.schedule(function () {\n                    startBuffer();\n                    !this.closed && subscriber.add(this.schedule(null, bufferCreationInterval));\n                }, bufferCreationInterval))\n            : (restartOnEmit = true);\n        startBuffer();\n        var bufferTimeSubscriber = new OperatorSubscriber(subscriber, function (value) {\n            var e_1, _a;\n            var recordsCopy = bufferRecords.slice();\n            try {\n                for (var recordsCopy_1 = __values(recordsCopy), recordsCopy_1_1 = recordsCopy_1.next(); !recordsCopy_1_1.done; recordsCopy_1_1 = recordsCopy_1.next()) {\n                    var record = recordsCopy_1_1.value;\n                    var buffer = record.buffer;\n                    buffer.push(value);\n                    maxBufferSize <= buffer.length && emit(record);\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (recordsCopy_1_1 && !recordsCopy_1_1.done && (_a = recordsCopy_1.return)) _a.call(recordsCopy_1);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n        }, function () {\n            while (bufferRecords === null || bufferRecords === void 0 ? void 0 : bufferRecords.length) {\n                subscriber.next(bufferRecords.shift().buffer);\n            }\n            bufferTimeSubscriber === null || bufferTimeSubscriber === void 0 ? void 0 : bufferTimeSubscriber.unsubscribe();\n            subscriber.complete();\n            subscriber.unsubscribe();\n        }, undefined, function () { return (bufferRecords = null); });\n        source.subscribe(bufferTimeSubscriber);\n    });\n}\n"]},"metadata":{},"sourceType":"module"}